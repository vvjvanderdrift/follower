#!/usr/bin/env python3

from follower import controllers

import rospy


if __name__ == '__main__':
    
    try:

        control_rate = 100 # Set to 0 for instant control as state message is arrived
        ego_model = "dynamic_bicycle" # kinematic_bicycle or dynamic_bicycle
        control_inputs = "ax_omega"

        rospy.init_node('follower', anonymous=True)
        rospy.loginfo(f"{rospy.get_name()} Starting control node at {control_rate} Hz with {ego_model} settings")
                
        controller = controllers.PID_Stanley(control_rate, ego_model, control_inputs)

        if(control_rate):
            rospy.Timer(rospy.Duration(1 / control_rate), controller.timer_callback)
            rospy.loginfo(f"Started timed control loop")

        else:
            rospy.loginfo(f"Started untimed control loop")
        rospy.spin()

    except rospy.ROSInterruptException:
        pass
